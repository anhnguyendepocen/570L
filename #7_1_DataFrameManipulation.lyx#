#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass book
\use_default_options true
\begin_modules
theorems-ams
eqs-within-sections
figs-within-sections
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 0
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 1in
\topmargin 1in
\rightmargin 1in
\bottommargin 1in
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Chapter
Data Reshaping
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

opts_chunk$set(cache.path = './cache/PivotTables/',
\end_layout

\begin_layout Plain Layout

               fig.path   = './figure/PivotTables/')
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset

Most of the time, our data is in the form of a data frame and we are interested
 in exploring the relationships.
 This chapter explores how to manipulate data frames and methods.
 
\end_layout

\begin_layout Section
Package 
\family typewriter
tidyr
\end_layout

\begin_layout Standard
There is a common issue with obtaining data with many columns that you wish
 were organized as rows.
 For example, I might have data in a grade book that has several homework
 scores and I'd like to produce a nice graph that has assignment number
 on the x-axis and score on the y-axis.
 Unfortunately this is incredibly hard to do when the data is arranged in
 the following way:
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

grade.book <- rbind(
\end_layout

\begin_layout Plain Layout

  data.frame(name='Alison',  HW.1=8, HW.2=5, HW.3=8),
\end_layout

\begin_layout Plain Layout

  data.frame(name='Brandon', HW.1=5, HW.2=3, HW.3=6),
\end_layout

\begin_layout Plain Layout

  data.frame(name='Charles', HW.1=9, HW.2=7, HW.3=9))
\end_layout

\begin_layout Plain Layout

grade.book
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
What we want to do is turn this data frame from a 
\emph on
wide
\emph default
 data frame into a 
\emph on
long
\emph default
 data frame.
 In MS Excel this is called 
\emph on
pivoting
\emph default
.
 Essentially I'd like to create a data frame with three columns: 
\family typewriter
name
\family default
, 
\family typewriter
assignment
\family default
, and 
\family typewriter
score
\family default
.
 That is to say that each homework datum really has three pieces of information:
 who it came from, which homework it was, and what the score was.
 It doesn't conceptually matter if I store it as 5 columns or 5 rows so
 long as there is a way to identify how a student scored on a particular
 homework.
 So we want to reshape the HW1 to HW5 columns into two columns (assignment
 and score).
 
\end_layout

\begin_layout Standard
This package was built by the sample people that created 
\family typewriter
dplyr
\family default
 and 
\family typewriter
ggplot2
\family default
 and there is a nice introduction at:
\begin_inset Newline newline
\end_inset

 
\begin_inset CommandInset href
LatexCommand href
target "http://blog.rstudio.org/2014/07/22/introducing-tidyr/"

\end_inset


\end_layout

\begin_layout Subsection*

\family typewriter
gather() and spread()
\end_layout

\begin_layout Standard
As with the 
\family typewriter
dplyr
\family default
 package, there are two main verbs to remember:
\end_layout

\begin_layout Enumerate
Gather - Gather multiple columns that are related into two columns that
 contain the original column name and the value.
 For example for columns 
\family typewriter
HW1
\family default
, ..., 
\family typewriter
HW5
\family default
 we would gather them into two column 
\family typewriter
HomeworkNumber
\family default
 and 
\family typewriter
Score
\family default
.
 In this case, we refer to 
\family typewriter
HomeworkNumber
\family default
 as the key column and 
\family typewriter
Score
\family default
 as the value column.
 So for any key:value pair you know everything you need.
\end_layout

\begin_layout Enumerate
Spread - This is the opposite of gather.
 Takes a key column (or columns) and a results column and forms a new column
 for each level of the key column(s).
\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

library(tidyr)
\end_layout

\begin_layout Plain Layout

# first we gather the score columns into columns we'll name Assesment and
 Score
\end_layout

\begin_layout Plain Layout

tidy.scores <- grade.book %>% gather( Assessement, Score, HW.1:HW.3 )
\end_layout

\begin_layout Plain Layout

tidy.scores
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To spread the key:value pairs out into a matrix, we use the 
\family typewriter
spread()
\family default
 command.
 
\begin_inset Newline newline
\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

# first we gather the score columns into columns we'll name Assesment and
 Score
\end_layout

\begin_layout Plain Layout

tidy.scores %>% spread( Assessement, Score )
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Exercises
\end_layout

\begin_layout Enumerate
Suppose we are given information about the maximum daily temperature from
 a weather station in Flagstaff, AZ.
 The file is available via the
\end_layout

\end_body
\end_document
